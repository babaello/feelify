<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Feelify ðŸŽµ</title>
  <style>
    /* === Base Reset === */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
    body {
      background: linear-gradient(135deg, #1e1e2f, #151525);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      transition: background 0.3s ease;
    }

    .glass {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 2rem;
      width: 100%;
      max-width: 700px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
      margin-top: 1rem;
      transition: all 0.3s ease;
    }

    h1 { font-size: 2rem; margin-bottom: 1rem; text-align: center; }

    input, button, select {
      padding: 0.8rem;
      margin: 0.5rem 0;
      width: 100%;
      font-size: 1rem;
      border-radius: 12px;
      border: none;
      outline: none;
    }

    button {
      background: #1db954;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover { background: #17a245; }

    .track { margin: 1rem 0; padding: 1rem; border-radius: 12px; background: rgba(255,255,255,0.05); display: flex; gap: 1rem; align-items: center; }
    .track img { width: 64px; height: 64px; border-radius: 8px; }
    .track-info { flex: 1; }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #333;
      color: #fff;
      padding: 1rem;
      border-radius: 10px;
      display: none;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show { display: block; opacity: 1; }

    .top-bar {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 700px;
      margin-bottom: 1rem;
    }

    .theme-toggle {
      cursor: pointer;
      background: transparent;
      border: 1px solid #888;
      color: #ccc;
      padding: 0.4rem 1rem;
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .theme-light {
      background: #fefefe;
      color: #222;
    }

    .theme-light .glass {
      background: rgba(255, 255, 255, 0.8);
      color: #111;
    }

    @media (max-width: 600px) {
      body { padding: 1rem; }
      .glass { padding: 1rem; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div id="status">ðŸŽ§ Feelify</div>
    <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ— Theme</button>
  </div>

  <div class="glass">
    <h1>How do you feel today?</h1>
    <input type="text" id="moodInput" placeholder="e.g. calm, excited, nostalgic" />
    <button onclick="searchMood()">Search Songs</button>
    <button onclick="randomMood()">ðŸŽ² Random Mood</button>
    <div id="results"></div>
  </div>

  <div class="toast" id="toast">Hello!</div>

  <script>
    const backendUrl = "https://feelify-backend.onrender.com"; // Your backend URL

    const moodToKeywords = {
      happy: ["uplifting", "energetic", "positive"],
      sad: ["melancholy", "slow", "emotional"],
      calm: ["ambient", "chill", "relaxing"],
      angry: ["intense", "heavy", "fast-paced"],
      nostalgic: ["retro", "classic", "timeless"],
      excited: ["party", "dance", "high energy"],
      relaxed: ["soft", "chill", "laid back"],
      romantic: ["love", "romantic", "soft pop"],
      anxious: ["instrumental", "soothing", "ambient"],
      bored: ["funky", "experimental", "groovy"]
    };

    let moodHistory = JSON.parse(localStorage.getItem("moodHistory")) || [];
    let darkMode = localStorage.getItem("darkMode") === "true";

    const toast = document.getElementById("toast");
    const results = document.getElementById("results");

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 3000);
    }

    function toggleTheme() {
      darkMode = !darkMode;
      document.body.classList.toggle("theme-light", !darkMode);
      localStorage.setItem("darkMode", darkMode);
    }

    function applyTheme() {
      if (!darkMode) {
        document.body.classList.add("theme-light");
      }
    }

    function randomMood() {
      const keys = Object.keys(moodToKeywords);
      const mood = keys[Math.floor(Math.random() * keys.length)];
      document.getElementById("moodInput").value = mood;
      searchMood();
    }

    function searchMood() {
      const mood = document.getElementById("moodInput").value.trim().toLowerCase();
      if (!mood) return showToast("Please enter a mood.");

      const keywords = moodToKeywords[mood] || [mood];

      fetch(`${backendUrl}/search?keywords=${encodeURIComponent(keywords.join(","))}`)
        .then(res => res.json())
        .then(data => {
          if (!data || !data.tracks || data.tracks.length === 0) {
            results.innerHTML = "<p>No songs found for that mood.</p>";
            return;
          }

          // Save to history
          moodHistory.unshift(mood);
          moodHistory = [...new Set(moodHistory)].slice(0, 10);
          localStorage.setItem("moodHistory", JSON.stringify(moodHistory));

          // Render
          results.innerHTML = "";
          data.tracks.forEach(track => {
            const el = document.createElement("div");
            el.className = "track";
            el.innerHTML = `
              <img src="${track.album.images[0].url}" />
              <div class="track-info">
                <strong>${track.name}</strong><br/>
                <em>${track.artists.map(a => a.name).join(", ")}</em>
              </div>
              <audio controls src="${track.preview_url}" style="height:32px"></audio>
            `;
            results.appendChild(el);
          });
        })
        .catch(() => {
          showToast("Error fetching songs. Try again.");
        });
    }

    applyTheme();
  </script>
</body>
</html>
